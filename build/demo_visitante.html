<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Acceso Visitante - CLAUT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .modal-backdrop { backdrop-filter: blur(5px); }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .page-card {
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .page-card.activa {
            border-color: #22c55e;
            background-color: #f0fdf4;
        }
        .page-card.inactiva {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.active {
            background: #22c55e;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }
        .toggle-switch.active::after {
            left: 32px;
        }

        /* Porsche-inspired Design System - Responsive Sidebar */
        :root {
            /* Primary Colors - Inspired by Porsche */
            --porsche-black: #1a1a1a;
            --porsche-charcoal: #2d2d2d;
            --porsche-silver: #8a8a8a;
            --porsche-white: #ffffff;
            --porsche-light-gray: #f5f5f5;
            --porsche-accent: #c9302c;
            /* Typography */
            --porsche-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --porsche-radius-lg: 12px;
        }

        /* === RESPONSIVE SIDEBAR FUNCTIONALITY === */

        /* Porsche-inspired Sidebar */
        .porsche-sidebar {
            background: linear-gradient(180deg, var(--porsche-black) 0%, var(--porsche-charcoal) 100%) !important;
            border-radius: var(--porsche-radius-lg) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
            height: calc(100vh - 2rem) !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            font-family: var(--porsche-font) !important;
        }

        .porsche-sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .porsche-sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .porsche-sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .porsche-sidebar .porsche-logo {
            color: var(--porsche-white) !important;
            font-weight: 700 !important;
            font-size: 1.5rem !important;
        }

        .porsche-nav-item {
            color: rgba(255, 255, 255, 0.8) !important;
            border-radius: 12px !important;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1) !important;
            font-weight: 500 !important;
        }

        .porsche-nav-item:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            color: var(--porsche-white) !important;
            transform: translateX(4px) !important;
        }

        .porsche-nav-item.active {
            background: rgba(199, 37, 43, 0.2) !important;
            color: var(--porsche-white) !important;
            border-left: 3px solid #C7252B !important;
        }

        /* Sidebar Overlay */
        .sidenav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 998;
            backdrop-filter: blur(4px);
        }

        .sidenav-overlay.show {
            opacity: 1;
            visibility: visible;
            z-index: 998;
        }

        /* Close button styling */
        #sidebarCloseBtn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        #sidebarCloseBtn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Sidebar always retractable - All screens */
        .porsche-sidebar {
            transform: translateX(-100%) !important;
            z-index: 999 !important;
            margin: 0 !important;
            top: 0 !important;
            left: 0 !important;
            border-radius: 0 !important;
            width: 280px !important;
            max-width: 280px !important;
            height: 100vh !important;
            position: fixed !important;
            display: block !important;
        }

        .porsche-sidebar.sidenav-show {
            transform: translateX(0) !important;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
        }

        /* Main content always without sidebar margin */
        .main-content {
            margin-left: 0 !important;
            width: 100% !important;
        }

        .container {
            margin-left: 0 !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        /* Desktop adjustments */
        @media (min-width: 1280px) {
            .container {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
        }

        /* Force sidebar behavior on all screens - Override any conflicting styles */
        .porsche-sidebar.sidebar-enhanced {
            transform: translateX(-100%) !important;
        }

        .porsche-sidebar.sidebar-enhanced.sidenav-show {
            transform: translateX(0) !important;
        }

        /* Override any Tailwind classes that might interfere */
        aside.porsche-sidebar {
            left: 0 !important;
            margin-left: 0 !important;
        }

        /* Ensure hamburger button works on all screens */
        @media (min-width: 1280px) {
            [sidenav-trigger] {
                display: block !important;
                visibility: visible !important;
            }
        }

        /* Hamburger button styling */
        .hamburger-btn {
            transition: all 0.3s ease;
        }

        .hamburger-btn:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.1) !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidenav-overlay" id="sidenavOverlay"></div>
    <!-- Porsche Sidebar -->
    <aside id="porscheSidebar"
        class="porsche-sidebar sidebar-enhanced fixed inset-y-0 flex-wrap items-center justify-between block w-full p-0 m-0 overflow-y-auto overflow-x-hidden antialiased transition-transform duration-200 border-0 max-w-64 ease-nav-brand z-990"
        aria-expanded="false">
        <div class="h-48 py-6 relative mb-4">
            <!-- Bot√≥n de cerrar para todas las pantallas -->
            <button class="absolute top-4 right-4 text-white hover:text-gray-300 text-2xl z-50 p-3 bg-black/30 rounded-lg hover:bg-black/50 transition-all"
                    id="sidebarCloseBtn"
                    sidenav-close
                    aria-label="Cerrar men√∫">
                <i class="fas fa-times"></i>
            </button>
            <a class="porsche-logo block px-6 py-4 m-0 text-center whitespace-nowrap" href="dashboard.html"
              target="_blank">
                <img src="../assets/img/apple-icon.png"
                  class="block mx-auto h-32 w-32 max-w-full transition-all duration-200 ease-nav-brand mb-4"
                  alt="main_logo" />
                <span class="block text-lg transition-all duration-200 ease-nav-brand text-white font-semibold mb-4">Cl√∫ster Admin</span>
            </a>
        </div>
        <hr class="h-px mt-4 mb-4 bg-transparent bg-gradient-to-r from-transparent via-black/40 to-transparent" />
        <div class="items-center block w-auto max-h-screen overflow-auto h-sidenav grow basis-full">
            <ul class="flex flex-col pl-0 mb-0 pt-4">
                <!-- Dashboard -->
                <li class="mt-2 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="dashboard.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-tachometer-alt text-blue-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Dashboard</span>
                    </a>
                </li>
                <!-- admin panel -->
                <li class="mt-2 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="admin-panel.html?login=success">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-tachometer-alt text-green-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Panel Administrador</span>
                    </a>
                </li>
                <!-- Usuarios -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="gestionar_usuarios.php">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-users text-emerald-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Gesti√≥n de Usuarios</span>
                    </a>
                </li>
                <!-- Empresas -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_empresas.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-building text-purple-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Empresas</span>
                    </a>
                </li>
                <!-- Descuentos -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_descuentos.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-tags text-red-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Descuentos</span>
                    </a>
                </li>
                <!-- Comit√©s -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_comite.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-users text-blue-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Comit√©s</span>
                    </a>
                </li>
                <!-- Eventos -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_evento.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-calendar text-orange-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Eventos</span>
                    </a>
                </li>
                <!-- Gesti√≥n Gr√°fico -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_gestion_grafico.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-chart-bar text-teal-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Gesti√≥n Gr√°fico</span>
                    </a>
                </li>
                <!-- Estad√≠sticas Din√°micas -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_estadisticasdinamicas.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-chart-line text-indigo-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Estad√≠sticas Din√°micas</span>
                    </a>
                </li>
                <!-- Visitantes - ACTIVE -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item active py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="demo_visitante.html">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-eye text-cyan-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Acceso Visitante</span>
                    </a>
                </li>
                <!-- Banners -->
                <li class="mt-0.5 w-full">
                    <a class="porsche-nav-item py-2.5 text-sm ease-nav-brand my-0 mx-4 flex items-center whitespace-nowrap px-4 transition-colors rounded-lg"
                        href="admin/banner-admin-mejorado.php">
                        <div class="shadow-md mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white">
                            <i class="fas fa-images text-pink-500"></i>
                        </div>
                        <span class="ml-1 duration-300 opacity-100">Banners</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <div class="main-content">
    <!-- Header -->
    <header class="bg-gradient-to-r from-red-600 to-red-700 text-white shadow-lg" style="background: linear-gradient(135deg, #C7252B 0%, #A01E24 100%);">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <button class="hamburger-btn bg-white/10 hover:bg-white/20 p-3 rounded-lg mr-4"
                            sidenav-trigger
                            id="hamburgerBtn"
                            aria-label="Abrir men√∫">
                        <i class="fas fa-bars text-white"></i>
                    </button>
                    <div>
                        <h1 class="text-3xl font-bold">üëÅÔ∏è Administrador de Acceso Visitante</h1>
                        <p class="text-red-200 mt-1">Configurar p√°ginas disponibles para visitantes</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="guardarConfiguracion()" class="bg-white text-red-600 px-4 py-2 rounded-lg hover:bg-red-50 transition">
                        <i class="fas fa-save mr-2"></i>Guardar Cambios
                    </button>
                    <button onclick="location.href='admin-panel.html'" class="bg-red-800 text-white px-4 py-2 rounded-lg hover:bg-red-900 transition">
                        <i class="fas fa-arrow-left mr-2"></i>Volver al Panel
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <div class="container mx-auto px-4 py-6">
        <!-- Informaci√≥n del Sistema -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Estado del Sistema de Visitantes</h2>
                    <p class="text-gray-600">Controla qu√© p√°ginas pueden ver los visitantes sin autenticaci√≥n</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-green-600" id="paginasActivas">0</div>
                    <div class="text-sm text-gray-500">P√°ginas Activas</div>
                </div>
            </div>
        </div>

        <!-- Configuraci√≥n de P√°ginas -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">P√°ginas Disponibles</h3>
                <button onclick="agregarPaginaPersonalizada()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-plus mr-2"></i>Agregar P√°gina
                </button>
            </div>

            <div id="listaPaginas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Las p√°ginas se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Configuraci√≥n Avanzada -->
        <div class="bg-white rounded-lg shadow p-6 mt-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Configuraci√≥n Avanzada</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Tiempo de Sesi√≥n</h4>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="tiempoSesion" value="2" min="1" max="24" class="border rounded px-3 py-2 w-20">
                        <span class="text-gray-600">horas</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">Tiempo antes de que expire la sesi√≥n de visitante</p>
                </div>

                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Acceso a Registro</h4>
                    <div class="toggle-switch" id="toggleRegistro" onclick="toggleRegistroVisitante()">
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Permitir que visitantes vean el enlace de registro</p>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="bg-white rounded-lg shadow p-6 mt-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Estad√≠sticas de Uso</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600">--</div>
                    <div class="text-sm text-gray-500">Visitas Hoy</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600">--</div>
                    <div class="text-sm text-gray-500">P√°ginas M√°s Vistas</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600">--</div>
                    <div class="text-sm text-gray-500">Tiempo Promedio</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-600">--</div>
                    <div class="text-sm text-gray-500">Conversiones</div>
                </div>
            </div>
            <p class="text-center text-gray-500 text-sm mt-4">
                <i class="fas fa-info-circle mr-1"></i>
                Estad√≠sticas detalladas disponibles pr√≥ximamente
            </p>
        </div>
    </div>

    <!-- Modal para Agregar P√°gina -->
    <div id="modalAgregarPagina" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto slide-in">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Agregar P√°gina Personalizada</h3>

                    <form id="formPaginaPersonalizada">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo</label>
                                <input type="text" id="paginaTitulo" class="w-full px-3 py-2 border rounded-lg" placeholder="Ej: Documentos P√∫blicos">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n</label>
                                <textarea id="paginaDescripcion" class="w-full px-3 py-2 border rounded-lg" rows="3" placeholder="Descripci√≥n de la p√°gina"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">URL</label>
                                <input type="text" id="paginaUrl" class="w-full px-3 py-2 border rounded-lg" placeholder="./mi-pagina.html">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Icono (FontAwesome)</label>
                                <input type="text" id="paginaIcono" class="w-full px-3 py-2 border rounded-lg" placeholder="fas fa-file" value="fas fa-file">
                            </div>
                        </div>

                        <div class="flex space-x-3 mt-6">
                            <button type="button" onclick="cerrarModalAgregar()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition">
                                Cancelar
                            </button>
                            <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                                Agregar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de p√°ginas
        let configuracionPaginas = [];
        let configuracionAvanzada = {
            tiempoSesion: 2,
            permitirRegistro: true
        };

        document.addEventListener('DOMContentLoaded', function() {
            cargarConfiguracion();
            configurarEventos();
        });

        function configurarEventos() {
            // Formulario de p√°gina personalizada
            document.getElementById('formPaginaPersonalizada').addEventListener('submit', function(e) {
                e.preventDefault();
                agregarPagina();
            });
        }

        async function cargarConfiguracion() {
            try {
                const response = await fetch('./api/visitante-config.php?action=listar');
                const result = await response.json();

                if (result.success && result.paginas) {
                    configuracionPaginas = result.paginas;
                } else {
                    // Configuraci√≥n por defecto
                    configuracionPaginas = [
                        {
                            id: 'empresas-convenio',
                            titulo: 'Empresas Convenio',
                            descripcion: 'Directorio de empresas con convenios',
                            icono: 'fas fa-handshake',
                            url: './empresas-convenio.html',
                            activo: true,
                            personalizada: false
                        },
                        {
                            id: 'boletines',
                            titulo: 'Boletines',
                            descripcion: 'Boletines informativos p√∫blicos',
                            icono: 'fas fa-newspaper',
                            url: './boletines.html',
                            activo: true,
                            personalizada: false
                        },
                        {
                            id: 'eventos',
                            titulo: 'Eventos',
                            descripcion: 'Calendario de eventos p√∫blicos',
                            icono: 'fas fa-calendar-alt',
                            url: './eventos.html',
                            activo: true,
                            personalizada: false
                        }
                    ];
                }

                renderizarPaginas();
                actualizarEstadisticas();
            } catch (error) {
                console.error('Error cargando configuraci√≥n:', error);
                mostrarNotificacion('Error cargando configuraci√≥n', 'error');
            }
        }

        function renderizarPaginas() {
            const container = document.getElementById('listaPaginas');

            const html = configuracionPaginas.map(pagina => `
                <div class="page-card ${pagina.activo ? 'activa' : 'inactiva'} p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center">
                            <i class="${pagina.icono} text-2xl text-blue-600 mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-gray-800">${pagina.titulo}</h4>
                                <p class="text-sm text-gray-600">${pagina.descripcion}</p>
                            </div>
                        </div>
                        <div class="toggle-switch ${pagina.activo ? 'active' : ''}" onclick="togglePagina('${pagina.id}')"></div>
                    </div>

                    <div class="text-xs text-gray-500 mb-2">
                        <i class="fas fa-link mr-1"></i>${pagina.url}
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded-full ${pagina.activo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${pagina.activo ? 'Activa' : 'Inactiva'}
                        </span>
                        ${pagina.personalizada ? `
                            <button onclick="eliminarPagina('${pagina.id}')" class="text-red-500 hover:text-red-700 text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function togglePagina(id) {
            const pagina = configuracionPaginas.find(p => p.id === id);
            if (pagina) {
                pagina.activo = !pagina.activo;
                renderizarPaginas();
                actualizarEstadisticas();
            }
        }

        function eliminarPagina(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta p√°gina?')) {
                configuracionPaginas = configuracionPaginas.filter(p => p.id !== id);
                renderizarPaginas();
                actualizarEstadisticas();
            }
        }

        function agregarPaginaPersonalizada() {
            document.getElementById('modalAgregarPagina').classList.remove('hidden');
        }

        function cerrarModalAgregar() {
            document.getElementById('modalAgregarPagina').classList.add('hidden');
            // Limpiar formulario
            document.getElementById('formPaginaPersonalizada').reset();
        }

        function agregarPagina() {
            const titulo = document.getElementById('paginaTitulo').value.trim();
            const descripcion = document.getElementById('paginaDescripcion').value.trim();
            const url = document.getElementById('paginaUrl').value.trim();
            const icono = document.getElementById('paginaIcono').value.trim();

            if (!titulo || !descripcion || !url) {
                mostrarNotificacion('Por favor completa todos los campos requeridos', 'error');
                return;
            }

            const nuevaPagina = {
                id: 'custom-' + Date.now(),
                titulo: titulo,
                descripcion: descripcion,
                icono: icono || 'fas fa-file',
                url: url,
                activo: true,
                personalizada: true
            };

            configuracionPaginas.push(nuevaPagina);
            renderizarPaginas();
            actualizarEstadisticas();
            cerrarModalAgregar();
            mostrarNotificacion('P√°gina agregada correctamente', 'success');
        }

        function toggleRegistroVisitante() {
            const toggle = document.getElementById('toggleRegistro');
            configuracionAvanzada.permitirRegistro = !configuracionAvanzada.permitirRegistro;
            toggle.classList.toggle('active');
        }

        async function guardarConfiguracion() {
            try {
                // Obtener tiempo de sesi√≥n
                configuracionAvanzada.tiempoSesion = parseInt(document.getElementById('tiempoSesion').value);

                const response = await fetch('./api/visitante-config.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        paginas: configuracionPaginas,
                        configuracion: configuracionAvanzada
                    })
                });

                const result = await response.json();

                if (result.success) {
                    mostrarNotificacion('Configuraci√≥n guardada correctamente', 'success');
                } else {
                    mostrarNotificacion('Error al guardar configuraci√≥n', 'error');
                }
            } catch (error) {
                console.error('Error guardando configuraci√≥n:', error);
                mostrarNotificacion('Error de conexi√≥n', 'error');
            }
        }

        function actualizarEstadisticas() {
            const paginasActivas = configuracionPaginas.filter(p => p.activo).length;
            document.getElementById('paginasActivas').textContent = paginasActivas;
        }

        function mostrarNotificacion(mensaje, tipo) {
            // Crear notificaci√≥n simple
            const notificacion = document.createElement('div');
            notificacion.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                tipo === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`;
            notificacion.textContent = mensaje;

            document.body.appendChild(notificacion);

            setTimeout(() => {
                notificacion.remove();
            }, 3000);
        }
    </script>

    </div>

    <script>
        // === SIDEBAR RETRACTABLE FUNCTIONALITY ===
        function initializeSidebar() {
            const sidebar = document.querySelector('.porsche-sidebar');
            const overlay = document.getElementById('sidenavOverlay');
            const hamburgerBtn = document.querySelector('[sidenav-trigger]');
            const closeBtn = document.getElementById('sidebarCloseBtn');

            console.log('Sidebar elements:', {
                sidebar: !!sidebar,
                overlay: !!overlay,
                hamburgerBtn: !!hamburgerBtn,
                closeBtn: !!closeBtn,
                screenWidth: window.innerWidth,
                isDesktop: window.innerWidth >= 1280
            });

            // Log computed styles for debugging
            if (sidebar) {
                const styles = window.getComputedStyle(sidebar);
                console.log('Sidebar computed styles:', {
                    display: styles.display,
                    transform: styles.transform,
                    left: styles.left,
                    position: styles.position,
                    zIndex: styles.zIndex
                });
            }

            if (!sidebar || !overlay || !hamburgerBtn) {
                console.error('Sidebar elements not found:', {
                    sidebar: !!sidebar,
                    overlay: !!overlay,
                    hamburgerBtn: !!hamburgerBtn
                });
                return;
            }

            // Toggle sidebar function
            function toggleSidebar(e) {
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                const isVisible = sidebar.classList.contains('sidenav-show');
                console.log('Toggle sidebar - currently visible:', isVisible);
                if (!isVisible) {
                    // Open sidebar
                    console.log('Opening sidebar');
                    sidebar.classList.add('sidenav-show');
                    sidebar.setAttribute('aria-expanded', 'true');
                    overlay.classList.add('show');
                    document.body.style.overflow = 'hidden';
                    // Focus management for accessibility
                    const firstLink = sidebar.querySelector('.porsche-nav-item');
                    if (firstLink) {
                        setTimeout(() => firstLink.focus(), 100);
                    }
                } else {
                    // Close sidebar
                    console.log('Closing sidebar');
                    closeSidebarInternal();
                }
            }

            // Close sidebar function
            function closeSidebarInternal() {
                console.log('Executing closeSidebarInternal');
                sidebar.classList.remove('sidenav-show');
                sidebar.setAttribute('aria-expanded', 'false');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
                // Return focus to hamburger button
                if (hamburgerBtn) {
                    hamburgerBtn.focus();
                }
            }

            // Event listeners
            console.log('Adding click event to hamburger button');
            hamburgerBtn.addEventListener('click', toggleSidebar);
            hamburgerBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                e.stopPropagation();
                toggleSidebar(e);
            }, { passive: false });

            if (overlay) {
                overlay.addEventListener('click', closeSidebarInternal);
                overlay.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    closeSidebarInternal();
                }, { passive: false });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeSidebarInternal();
                });
                closeBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeSidebarInternal();
                }, { passive: false });
            }

            // Close on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSidebarInternal();
                }
            });

            // Handle window resize - Keep sidebar closed on all screen sizes
            window.addEventListener('resize', function() {
                // Optional: could add logic here if needed
            });

            // Swipe to close functionality
            let touchStartX = 0;
            let touchStartY = 0;
            sidebar.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            sidebar.addEventListener('touchmove', function(e) {
                if (!touchStartX) return;
                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const diffX = touchStartX - currentX;
                const diffY = Math.abs(touchStartY - currentY);

                // Swipe left to close
                if (diffX > 50 && diffY < 100) {
                    closeSidebarInternal();
                    touchStartX = 0;
                    touchStartY = 0;
                }
            }, { passive: true });

            // Keyboard navigation in sidebar
            sidebar.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSidebarInternal();
                }
                // Arrow navigation
                if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    const navItems = Array.from(sidebar.querySelectorAll('.porsche-nav-item:not([style*="display: none"])'));
                    const currentIndex = navItems.indexOf(document.activeElement);
                    if (e.key === 'ArrowDown') {
                        const nextIndex = (currentIndex + 1) % navItems.length;
                        navItems[nextIndex].focus();
                    } else {
                        const prevIndex = currentIndex <= 0 ? navItems.length - 1 : currentIndex - 1;
                        navItems[prevIndex].focus();
                    }
                }
            });

            console.log('‚úÖ Sidebar functionality initialized successfully');
        }

        // Legacy function compatibility
        function closeSidebar() {
            const sidebar = document.querySelector('.porsche-sidebar');
            const overlay = document.getElementById('sidenavOverlay');
            if (sidebar && overlay) {
                sidebar.classList.remove('sidenav-show');
                sidebar.setAttribute('aria-expanded', 'false');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // Initialize sidebar when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeSidebar, 100);
        });
    </script>
</body>
</html>